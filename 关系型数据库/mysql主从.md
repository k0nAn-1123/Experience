# mysql主从

## 主从复制原理

MySQL 主从复制是指数据可以从一个MySQL数据库服务器主节点复制到一个或多个从节点。MySQL 默认采用异步复制方式，这样从节点不用一直访问主服务器来更新自己的数据，数据的更新可以在远程连接上进行，从节点可以复制主数据库中的所有数据库或者特定的数据库，或者特定的表。

MySQL 主从复制默认是异步的模式。MySQL增删改操作会全部记录在binary log中，当slave节点连接master时，会主动从master处获取最新的bin log文件。并把bin log中的sql relay。

## 主从复制主要用途

#### 读写分离

在开发工作中，有时候会遇见某个sql 语句需要锁表，导致暂时不能使用读的服务，这样就会影响现有业务，使用主从复制，让主库负责写，从库负责读，这样，即使主库出现了锁表的情景，通过读从库也可以保证业务的正常运作。、

#### 数据实时备份

#### 高可用HA

#### 架构扩展

随着系统中业务访问量的增大，如果是单机部署数据库，就会导致I/O访问频率过高。有了主从复制，增加多个数据存储节点，将负载分布在多个从节点上，降低单机磁盘I/O访问的频率，提高单个机器的I/O性能。

## 主从形式

- 一主一从
- 一主多从
- 多主一从
- 双主复制
- 级联复制

### 主从原理

1. 主节点创建一个log dump线程，用于发送bin-log的内容。读取bin-log的内容时，此线程会对主节点上的bin-log加锁，在发送给从节点之前，锁会被释放。
2. 从节点创建一个I/O线程来连接主节点，请求主节点中更新的bin-log，并将相关内容保存在本地relay-log。
3. 从节点中SQL线程负责读取relay-log中的内容，解析成具体的操作并执行，最终保证主从数据一致。

## 复制方式

1. 异步模式

   主节点不会主动将bin-log push到从节点，从节点也不能及时地将最新的bin-log同步到本地。

2. 半同步模式

3. 全同步模式

   - binlog模式记录
   - GTID辅助模式

