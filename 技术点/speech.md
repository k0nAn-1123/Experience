# 常见消息队列类型选取以及场景应用

https://zhuanlan.zhihu.com/p/60289581

https://blog.csdn.net/wufaliang003/article/details/80219281

https://blog.csdn.net/lifaming15/article/details/79942793

https://zhuanlan.zhihu.com/p/60288391

## 消息队列

### 通信方式

消息队列是一种应用间的通信方式，消息发送后可以立即返回，有消息系统来确保信息的可靠传递。与http协议不同的是，消息队列的通信方式种消息的传递是由发送方送到消息系统，然后消息系统将消息送到接收方，两者并不直接接触，消息的成功送达由消息系统确保。

#### 异步

在上述陈述中我们可以看到消息队列的通信方式是异步处理请求的。在高并发分布式环境下，由于来不及同步处理，通过使用消息队列，可以异步处理请求，从而缓解系统的压力。

#### 解耦

而且我们的项目现在是采用的微服务架构，好像别的项目组也是有很多采用了微服务架构，如果使用过多的api调用的话，调用方使用不当和被调用方处理不当都会对另一方服务器乃至整个服务架构造成压力。采用消息队列的另一个好处就是对服务进行解耦，发送方只管发送消息，接收方只管接收消息，对双方性能造成影响的只有自己一方对消息的处理操作，而不会因为对方对消息的处理不当而受到影响。

#### 重复

在消息队列中还有一种设计就是，消息在消息系统中是可以重复消费的，可以复用也是消息队列的优点。

producer-broker-consumer

## 消息队列工作模型

### 一对一的queue

### 工作模式

### 发布订阅模式

### 路由模式

### 通配符模式

## 常见消息队列类型

发布订阅/生产消费

### RabbitMQ

由erlang语言开发，并发能力强，支持很多协议：AMQP XMPP SMTP STOMP。功能强大，属于重量级消息队列应用，适合于企业开发。对路由 负载均衡 数据持久化都有很好的支持。

而且rabbitmq的一个很大的优点是有着比较优秀的管理界面和用户权限设置，通过管理界面是可以看到消息发布和订阅的日志的，对于后期维护是很方便的，而且通过管理界面可以看到消息队列对于内存的占用等信息。

首次部署难度低

路由

负载均衡

数据持久化

工作模型比较多，支持五种工作模型

但是由于是erlang开发，很难看懂源码，二次开发和维护比较难。

### ActiveMQ

使用java语言开发，可以直接打包成jar包，放到java项目中配置，还可以通过java进行一些拓展，类似于tomcat的拓展，对于java开发者来说体验很棒，但是目前公司里主流技术栈好像是不包括java的，所以这个优点对于我们开发者来说没有那么有吸引力。

工作模式单一，只有queue和topic两种，多对一的queue和广播模式topic。

因为支持java拓展，而且可以作为jar包打包，所以功能比较齐全，被很多电商平台应用，主要是为了消除高并发访问高峰。

属于主从架构。

### RocketMQ

出自阿里巴巴的开源产品，用java语言实现，被广泛应用在订单，交易，充值，流计算，消息推送，日志流式处理，binglog分发等场景。因为是开源的，所以修改底层源码，针对业务逻辑进行优化。

性能高，可用性高，属于分布式架构，消息可靠性很高。

这项技术比较新，社区活跃度一般，无管理界面，文档不齐全，首次部署难度高。

### kafka

scala语言开发，可用性非常高，吞吐量高，日志领域成熟，支持多种开发语言但是java优先。

在日志领域非常成熟，被多个公司和开源项目使用，在大数据实时计算和日志采集被大规模使用。

工作模式比较简单，主要支持简单的队列功能。

## 优劣比较

### 性能

稳定性：rocketmq最高，经历了阿里巴巴多次双十一考验。

吞吐量：rocketmq最高。

延时：rabbitmq最短，微秒级。

可用性：kafka和rockermq最高，支持分布式架构，和其他的分布式架构以及主从架构不一样的是，一个topic的消息(或者说一类消息)是放在多个节点(broker)上的。其他的消息队列还是传统的消息队列，只不过提供了一些集群的机制，将一个消息写到队列里的话，这个消息会写进所有实例中去，对于性能消耗很大。

### 开发体验

对于java技术栈来说activemq开发体验最好，rocketmq其次。

部署难度：rabbtimq最低。

社区完善度：rocket最新，所以最不完善。且不提供快速入门。

管理界面：除了rocketmq都有，rabbitmq的管理界面是功能最齐全的。

功能：rabbitmq支持最多的工作模式，也有最多的管理功能。

## 常见场景应用

### 日志处理

客户端采集日志，定时写进kafka消息队列，kafka负责日志数据的采集存储和发送。定时订阅消费队列中的日志数据。

### 流量削峰

比如电商活动中的秒杀活动，还有抢票活动，这些活动共同的特点是流量巨大，也就是一瞬间的并发量十分巨大。每一次的请求需要完成的操作是 订单生成 数据写入 扣减库存 短信或邮件通知等。这些操作如果同步进行的话，对于数据库和服务端来说压力都非常大。而且对于用户来说，只需要知道自己下单成功就可以了，这些操作其实是可以在返回给用户结果之后进行的。

### 消息推送

比如社交软件中的消息推送功能。